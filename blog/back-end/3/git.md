---
title: Git
date: 2022-3-22
categories:
  - Java 笔记
tags:
  - Git
  - Gitee
---

## 1. 目标

- 了解 Git 基本概念
- 能够概述 Git 工作流程
- 能够使用 Git 常用命令
- 熟悉 Git 代码托管服务
- 能够使用 IDEA 操作 Git

## 2. 概述

### 1. 开发中的实际场景

1. 备份
2. 代码还原
3. 协同开发
4. 追溯问题代码的编写人和编写时间

### 2. 版本控制器的方式

- 集中式版本控制工具（**SVN**）
- 分布式版本控制工具（**Git**）

### 3. Git 工作流程

命令如下：

1. `clone`（克隆）：从远程仓库中克隆代码到本地仓库。
2. `checkout`（检出）：从本地仓库中检出一个仓库分支然后进行修订。
3. `add`（添加）：在提交前将代码提交到暂存区。
4. `commit`（提交）：提交到本地仓库。本地仓库中保存修改的各个历史版本。
5. `fetch`（抓取）：从远程库拉取到本地库，不进行任何的合并动作，一般操作比较少。
6. `pull`（拉取）：从远程库拉取到本地库，自动进行合并（merge），然后放到工作区，相当于 fetch+merge。
7. `push`（推送）：修改完成后，需要和团队成员共享代码时，将代码推送到远程仓库。

## 3. Git 的安装与常用工具

### 1. Git bash 命令

- `ls/ll` 查看当前文件内容
- `cat` 查看文件内容
- `touch` 创建文件
- `vi` vi 编辑器

### 2. Git 环境配置

#### 1. 下载与安装

备注：

Git GUI：Git 提供的图形界面工具

Git Bash：Git 提供的命令行工具

当安装 Git 后首先要做的事情是设置用户名和 email 地址。

这是非常重要的，因为每次 Git 提交都会使用该用户信息

#### 2. 基本配置

1. 打开 Git Bash
2. 设置用户信息

```bash
$ git config --global user.name "Guany"
$ git config --global user.email "1084072690@qq.com"
```

3. 查看配置信息

```bash
$ git config --global user.name
$ git config --global user.email
```

#### 3. 为常用命令配置别名 （可选）

有些常用指令非常多，每次都要输入好多参数，我们可以使用别名。

1. 打开用户目录，创建 .bashrc 文件

部分 windows 系统不允许用户创建点号开头的文件，可以打开 git bash，执行 `touch ~/.bashrc`

2. 在 .bashrc 文件中输入如下内容：

```bash
# 用于输出 git 提交日志
alias git-log='git log --pretty=oneline --all --graph --abbrev-commit'
# 用于输出当前目录所有文件基本信息
alias la='ls -lAh'
```

3. 打开 git bash，执行 `source ~/.bashrc`

#### 4. 解决 git bash 乱码问题

1. 打开 git bash 执行下面命令

```bash
$ git config --global core.quotepath false
```

2. $(git_home)/etc/bash.bashrc 文件加入下面两行

```bash
export LANG="zh_CN.UTF-8"
export LC_ALL="zh_CN.UTF-8"
```

### 3. 获取本地仓库

要使用 Git 对我们的代码进行版本控制，首先需要获得本地仓库

1. 在电脑任意位置创建一个空目录（例如 test）作为我们的本地仓库
2. 进入这个目录中，点击右键打卡 git bash 窗口
3. 执行命令 git init
4. 如果创建成功后可在文件夹看到隐藏的 .git 目录

### 4. 基础操作指令

Git 工作目录下对文件的**修改**（增加、删除、更新）会存在几个状态，这些**修改**的状态会随着我们执行 Git 的命令而发生变化。

1. git add（工作区——>暂存区）
2. git commit（暂存区——>本地仓库）

#### 1. 查看修改的状态（status）

- 作用：查看的修改的状态（暂存区、工作区）
- 命令形式：`git status`

#### 2. 添加工作区到缓存区（add）

- 作用：添加工作区一个或多个文件的修改到暂存区
- 命令形式：`git add 单个文件名|通配符`
  - 将所有修改加入缓存区：`git add .`

#### 3. 提交暂存区到本地仓库（commit）

- 作用：提交暂存区内容到本地仓库的当前分支
- 命令形式：`git commit -m '注释内容'`

#### 4. 查看提交日志（log）

- 作用：查看提交记录
- 命令形式：`git log [option]`
  - options
    - --all 显示所有分支
    - --pretty=oneline 将提交信息显示为一行
    - --abbrev-commit 使得输出的 commitId 更简短
    - --graph 以图的形式显示

#### 5. 版本回退

- 作用：版本切换
- 命令形式：`git reset --hard commitID`
  - commitID 可以使用`git-log`或`git log`指令查看
- 如何查看已经删除的记录？
  - `git reflog`
  - 这个指令可以看到已经删除的提交记录

#### 6. 添加文件至忽略列表

一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。在这种情况下，我们可以在工作目录中创建一个名为 .gitignore 的文件(文件名称固定)，列出要忽略的文件模式。

### 5. 分支

几乎所有的版本控制系统都以某种形式支持分支。使用分支意味着你可以把你的工作从开发主线上分离开来进行重大的 Bug 修改、开发新的功能，以免影响开发主线。

#### 1. 查看本地分支

- 命令：`git branch`

#### 2. 创建本地分支

- 命令：`git branch 分支名`

#### 3. 切换分支（checkout）

- 命令：`git checkout 分支名`

我们还可以直接切到一个不存在的分支（创建并切换）

- 命令：`git checkout -b 分支名`

#### 4. 合并分支（merge）

一个分支上的提交可以合并到另一个分支

命令：`git merge 分支名称`

#### 5. 删除分支

**不能删除当前分支，只能删除其他分支**

`git branch -d b1` 删除分支时，需要做各种检查

`git branch -D b1` 不做任何检查，强制删除

#### 6. 解决冲突

当两个分支上对文件的修改可能会存在冲突，例如同时修改了同一个文件的同一行，这时就需要手动解决冲突，解决冲突步骤如下：

1. 处理文件中有冲突的地方
2. 将解决完冲突的文件加入暂存区（add）
3. 提交到仓库（commit）

#### 7. 开发中分支使用原则与流程

几乎所有的版本控制系统都以某种形式支持分支。使用分支意味着你可以把你的工作从开发主线上分离开来进行重的的 bug 修改，开发新的功能，以免影响开发主线。

在开发中，一般有如下分支使用原则与流程：

- master（生产分支）

  线上分支，主分支，中小规模项目作为线上运行的应用对应的分支；

- develop（开发）分支

  是从 master 创建的分支，一般作为开发部门的主要开发分支，如果没有其他并行开发不同期上线的需求，都可以在此版本进行开发，阶段开发完成后，需要合并到 master 分支，准备上线。

- feature/xxxx 分支

  从 develop 创建的分支，一般是同期并行开发，但不同期上线的创建的分支，分支上的研发任务完成后合并到 develop 分支。

- hotfix/xxxx 分支

  从 master 派生的分支，一般作为线上 bug 修复使用，修复完成后需要合并到 master、test、develop 分支。

- 还有一些其他分支。例如 test 分支（用于代码测试），pre 分支（预上线分支）等等。

## 4. Git 远程仓库

### 1.常用的托管服务【远程仓库】

- **GitHub**（地址：[GitHub](https://github.com/)）是一个面向开源及私有软件项目的托管平台，因为只支持 Git 作为唯一的版本库格式进行托管，故名 GitHub
- **码云**（地址：[Gitee](https://gitee.com/)）是国内的一个代码托管平台，由于服务器在国内，所以相比于 GitHub，码云速度会更快
- **GitLab**（地址：[GitLab](https://about.gitlab.com/)）是一个用于仓库管理系统的开源项目，使用 Git 作为代码管理工具，并在此基础上搭建起来的 web 服务，一般用于企业、学校等内部网络搭建 Git 私服。

### 2. 配置 SSH 公钥

- 生成 SSH 公钥
- 不断回车
  - 如果公钥已存在，则自动覆盖
- Gitee 设置账户公钥
  - 获取公钥
    - `cat ~/.ssh/id_rsa.pub`
  - 验证是否配置成功
    - `ssh -T git@gitee.com`

### 3. 操作远程仓库

#### 1. 添加远程仓库

此操作是先初始化本地库，然后与已创建的远程库进行对接。

- 命令：`git remote add <远程名称> <仓库路径>`
  - 远程名称，默认是 orgin，取决于远端服务器设置
  - 仓库路径，从远程服务器获取此 URL
  - 例如：`git remote add orgin git@gitee.com:tlyboy/Typora.git`

#### 2. 查看远程仓库

- 命令：`git remote`

#### 3. 推送到远程仓库

- 命令：`git push [-f] [--set-upstream] [远端名称 [本地分支名] [:远端分支名] ]`
  - 如果远程分支名和本地分支名相同，则可以只写本地分支
    - `git push orgin master`
  - `-f`表示强制覆盖
  - `--set-upstream`推送到远端的同时并且建立起和远端分支的关联关系。
    - `git push --set-upstream orgin master`
  - 如当前分支已经和远端分支关联，则可以省略分支名和远端名。
    - `git push` 将 master 分支推送到已关联的远端分支。

#### 4. 本地分支与远程分支的关联关系

- 查看关联关系我们可以使用 `git branch -vv` 命令

#### 5. 从远程仓库克隆

如果已经有一个远端仓库，我们直接 clone 到本地。

- 命令：`git clone <仓库路径> [本地目录]`
  - 本地目录可以省略，会自动生成一个目录

#### 6. 从远程仓库中抓取和拉取

远程仓库和本地的分支一样，我们可以进行 merge 操作，只是需要先把远端仓库里的更新都下载到本地，再进行操作。

- 抓取 命令：`git fetch [remote name] [branch name]`
  - **抓取指令就是仓库里的更新都抓取到本地，不会进行合并**
  - 如果不指定远端名称和分支，则抓取所有分支。
- 拉取 命令：`git pull [remote name] [branch name]`
  - **拉取指令就是将远端仓库的修改拉倒本地并自动进行合并，等同于 fetch+merge**
  - 如果不指定远端名称和分支名，则抓取所有并更新当前分支。

#### 7. 解决合并冲突

在一段时间内，A、B 用户修改了同一个文件，且修改了同一行位置的代码，此时会发生合并冲突。

A 用户在本地修改代码后优先推送到远程仓库，此时 B 用户在本地修订代码，提交到本地仓库后，也需要推送到远程仓库，此时 B 用户晚于 A 用户，**故需要先拉取远程仓库的提交，经过合并后才能推送到远端分支**。

在 B 用户拉取代码时，因为 A、B 用户同一段时间修改了同一个文件的相同位置的代码，故会发生合并冲突。

**远程分支也是分支，所以合并时冲突的解决方式也和解决本地分支冲突相同。**

## 附几条铁令

1. **切换分支前先提交本地的修改**
2. 代码及时提交，提交过了就不会丢
3. 遇到任何问题都不要删除文件目录
